# README<br>

**Working in Progress**<br>
**This repository accompanies our paper currently under review**<br>

## 1. Introduction<br>
A ResUNet model integrated with Channel and Spatial Attention Module (CSAM) for Raman spectral applications including:<br>
─ Noise removal and baseline correction reconstruction<br>
─ Classification and unmixing of mixed─sample Raman spectra<br>

## 2. Contents<br>
├── README			// help<br>
├── requirements.txt	// Environmental requirements<br>
├── models				// Include the models used<br>
├── dataset				// Contains experimental datasets used in the paper<br>
├── run				// Program running result<br>
├── train.py			// Training for spectral reconstruction model<br>
├── fit.py				// Test of reconstruction for extra dataset<br>
├── predict.py			// Reconstruction for spectra measured<br>
├── predict_refe.py		// Reconstruction for spectra measured from references<br>
├── train_classify.py		// Training code for classification and unmixing model<br>
├── classify_pred.py		// Classification and unmixing for spectra measured<br>
├── tools.py			// Function Toolbox<br>

## 3. Environmental<br>
The environmental dependence of this paper：<br>
Python == 3.8.19<br>
Tensorflow == 2.10.0<br>
CUDA == 11.2.2<br>
cuDNN == 8.1.0.77<br>
Other dependencies are in requirements.txt<br>

## 4. Neural Network Models<br>
─‘models’: Contains implemented models from the paper:<br>
─ ResUNet<br>
─ SE─ResUNet<br>
─ BAM─ResUNet<br>
─ ECA─ResUNet<br>
─ CBAM─ResUNet<br>
─ CSAM─ResUNet<br>

## 5. Datasets<br>
**Dataset download address: (https://www.scidb.cn/s/NbEFze) <br>**
The compressed package contains the dataset and the already trained model (run).<br>
Extract the compressed package to the root directory of this project, or after extraction, copy the "dataset" folder to the root directory of this project<br>

**─‘dataset’: Contains experimental datasets used in the paper<br><br>**
**─ ‘dataset_train_20000’: Training dataset for spectral reconstruction (20,000 spectra)<br>**
{ <br>
‘all_original_spectra’ #Simulated spectra generated by superposition of Gaussian and Lorentzian linear lines with voigt lines<br>
‘all_bl_spectra'#Spectra with random polynomial baseline added <br>
‘all_simulate_spectra’ #Simulated spectra with random Gaussian noise added <br>
‘all_ info' #Spectral info, 7 columns from left to right are serial number, random polynomial baseline order, random Gaussian noise standard deviation rank, random Gaussian noise standard deviation value, signal-to-noise ratio, peak signal-to-noise ratio, and Coefficient of Variation<br>
‘seed’#Randomly generates a random seed of the simulated dataset<br>
‘wavenumber' #Raman shift range <br>
} <br><br>
**─ ‘dataset_extra_10000’: Extra validation dataset for spectral reconstruction (10,000 spectra)** 
<br>{same as dataset_train_20000.mat} <br><br>
**─ ‘dataset_reference_norm’: Raman spectral dataset published in other papers, interpolated to complement the length and normalized.<br><br>**
**─ ‘dataset_150mW_5000ms’: Experimental single─component MP spectra<br>**
{ <br>
‘PC’#measured PC spectra <br>
‘PC_norm’#measured PC spectra after normalization <br>
‘raw_spectra’#all microplastic species Normalized spectra <br>
} <br><br>
**─ ‘dataset_train_mix_36000’: Training dataset for mixed─spectra classification (36,000 spectra)<br>**
{ <br>
‘Data_mix_sumilate_Struct’#Simulated spectra of 10 classes of mixed microplastics Dataset <br>
‘Data_endmember_Struct1/2’#Single spectra corresponding to 10-class mixing spectra <br>
‘Data_pure_single_Struct’#Single components used to simulate mixing spectra Microplastic spectra, after reconstruction <br>
‘Data_pure_norm_Struct’#Normalized Data_pure_single_Struct <br>
} <br><br>
**─ ‘dataset_mixture_raw’: Experimental mixed─component MP spectra<br>**
{ <br>
‘PCPE’#measured PCPE mixture Raman spectrum <br>
‘PCPE_norm’#measured PCPE mixture Raman spectrum after normalization<br>
‘raw_spectra' dataset of mixed microplastic spectra for all species <br>
} <br><br>
**─ ‘dataset_mixture_denoised’: Preprocessed experimental mixed microplastic spectra after reconstruction<br>**
{ <br>
‘raw’#unreconstructed spectra <br>
‘processed’#reconstructed spectra <br>
‘PCPE’#reconstructed PCPE spectra <br>
‘PCPE_norm'#Reconstructed PCPE spectrum after normalization <br>
}<br>

## 6. Model Training and Prediction<br>
**Quick Start<br>**
**Data set download address: (https://www.scidb.cn/s/NbEFze) <br>**
The compressed package contains a "run" folder, which includes the trained model. Extract the "CSAM-ResUNet" compressed package to the root directory of this project, or after extraction, copy the "run" folder to the root directory of this project
### 6.1 Spectral Reconstruction Models:<br>

**─ ‘train’: Training code for spectral reconstruction models<br>**
	─ ‘parser’: Configure parameters (model selection, batch size, learning rate, epochs, etc.)<br>
	─ ‘train_path’: Training dataset path (e.g., ‘dataset_train_20000.mat’)<br>
	─ ‘extra_path’: Extra validation dataset path (e.g., dataset_extra_10000.mat’)<br>
	─ ‘output’: Training results saved to ‘./run/model name_ _timestamp_’<br>

**─ ‘fit’: Load trained models for additional validation<br>**
	─‘extra_path’： Extra validation dataset path (e.g., dataset_extra_10000.mat’)<br>
	─‘run_path’：Trained model path (‘model name_ _timestamp_’)<br>
	─‘output’：Results saved to ‘./run/model name_ _timestamp_’<br>

**─ ‘predict’: Apply trained models to experimental single/mixed─component spectra<br>**
	─‘run_path’：Trained model path (‘model name_ _timestamp_’)<br>
	─‘path_list’：Select the unreconstructed mixed spectrum [path_list_un], or the single-component microplastic spectrum [path_list]<br>
	─‘output’：Results saved to ‘./run/model name_ _timestamp_’<br>

**─ ‘predict_refe’: Apply models to public Raman spectra from other studies<br>**
	─‘run_path’：Trained model path (‘model name_ _timestamp_’)<br>
	─‘path_list’：Select the dataset<br>
	─‘output’：Results saved to ‘./run/model name_ _timestamp_’<br>

### 6.2 Mixed─Spectra Classification Models:<br>
**─ ‘train_classify’: Training code for classification models<br>**
	─ ‘parser’: Configure parameters (batch size, learning rate, epochs, etc.)<br>
	─ ‘path_data_train’: Training dataset path (e.g., "dataset_train_mix_36000.mat")<br>
	─ ‘path_data_pred’: Experimental mixed─spectra dataset path<br>
	─ ‘output’: Results saved to ‘./run/model name_ _timestamp_’<br>

**─ ‘classify_pred’: Load trained models for experimental mixed─spectra classification/unmixing<br>**
	─ ‘run_path’: Trained model path (‘model name_ _timestamp_’)<br>
	─ ‘path_list’: Measure the paths of the spectral dataset of the mixed samples, and select the unprocessed spectra [path_list_un] or the processed spectra [path_list_nn].<br><br>

## Citation
If this project has been helpful to your research or work, please cite our paper:<br><br>
@article{CSAM-ResUNet,<br>
  title   = {Cascaded improved neural network for Raman spectra of mixed microplastics reconstruction, classification and unmixing},<br>
  author  = {Weixiang Huang, Jiajin Chen, Hao Xiong, Tu Tan, Guishi Wang, Kun Liu, Chilai Chen and Xiaoming Gao},<br>
  journal = {Analytical Chemistry},<br>
  year    = {2025},<br>
  note    = {Under Review}<br>
}
______
<br><br>
# README
**正在进行的工作**<br>
这个存储库伴随着我们目前正在审查的论文。<br>

## 1.简介
一种结合通道和空间注意力模块（Channel and Spatial Attention Module, CSAM）的ResUNet模型，用于拉曼光谱的噪声去除和基线矫正的重构，混合样品拉曼光谱分类识别和解混。

## 2.目录
├── README			// 帮助文档<br>
├── requirements.txt	// 环境要求<br>
├── models				// 包含使用的模型<br>
├── dataset				// 包含使用的数据集<br>
├── run				// 程序运行结果<br>
├── train.py			// 光谱重构模型的训练<br>
├── fit.py				// 测试额外数据集的光谱重构<br>
├── predict.py			// 对实测光谱进行光谱重构<br>
├── predict_refe.py		// 对参考文献的公开数据光谱重构<br>
├── train_classify.py		// 混合光谱分类和解混模型的训练代码<br>
├── classify_pred.py		// 混合光谱分类和解混模型在实测数据应用<br>
├── tools.py			// 工具函数<br>


## 3.环境
论文实现的环境依赖：
Python == 3.8.19<br>
Tensorflow == 2.10.0<br>
Cuda == 11.2.2<br>
cuDNN == 8.1.0.77<br>
其他依赖项在requirements.txt<br>

## 4.神经网络模型
─models：包含论文所用模型：<br>
ResUNet<br>
SE─ResUNet<br>
BAM─ResUNet<br>
ECA─ResUNet<br>
CBAM─ResUNet <br>
CSAM─ResUNet<br>

## 5.数据集
**数据集下载地址:(https://www.scidb.cn/s/NbEFze)<br>**
压缩包包含数据集(dataset)和已经训练好的模型(run)<br>
**将压缩包解压到该项目根目录，或解压后将“dataset”文件夹复制到该项目根目录<br>**

**─dataset：包含论文所用的训练集<br>**


**─dataset_train_20000.mat：用于光谱重构模型训练的数据集，光谱数为20000<br>**
{<br>
‘all_original_spectra’#高斯线形和洛伦兹线形线形叠加生成的voigt线形模拟光谱<br>
‘all_bl_spectra’#加入随机多项式基线的光谱<br>
‘all_simulate_spectra’#加入随机高斯噪声的模拟光谱<br>
‘all_info’#光谱信息，7列从左到右分别是序号，随机多项式基线阶数，随机高斯噪声标准差等级，随机高斯噪声标准差数值，信噪比，峰值信噪比，离散系数<br>
‘seed’#随机生成模拟数据集的随机种子<br>
‘wavenumber’#拉曼位移范围<br>
}<br><br>
**─dataset_extra_10000.mat：重构模型训练好后额外验证的数据集，光谱数10000<br>**
{同dataset_train_20000.mat}<br><br>
**─dataset_reference_norm.mat：其他论文公开的拉曼光谱数据集，经过插值补齐长度和归一化处理<br><br>**
**─dataset_150mW_5000ms.mat：实测的微塑料单一组分数据集<br>**
{<br>
‘PC’#测量的PC光谱<br>
‘PC_norm’#归一化后测量的PC光谱<br>
‘raw_spectra’#所有的微塑料种类归一化后的光谱<br>
}<br><br>
**─dataset_train_mixture_36000.mat：混合光谱分类模型训练的数据集，光谱数为36000<br>**
{<br>
‘Data_mix_sumilate_Struct’#10类混合微塑料模拟光谱数据集<br>
‘Data_endmember_Struct1/2’#10类混合光谱对应的单一光谱<br>
‘Data_pure_single_Struct’#用于模拟混合光谱的单组份微塑料光谱，经过重构处理<br>
‘Data_pure_norm_Struct’#归一化后的Data_pure_single_Struct<br>
}<br><br>
**─dataset_mixture_raw.mat：实测的微塑料混合组分数据集<br>**
{<br>
‘PCPE’#实测PCPE混合拉曼光谱<br>
‘PCPE——norm’#归一化后实测PCPE混合拉曼光谱<br>
‘raw_spectra’所有种类的混合微塑料光谱数据集<br>
}<br><br>
**─dataset_mixture_denoised.mat：实测的微塑料混合组分数据集，经重构预处理<br>**
{<br>
‘raw’#未重构光谱<br>
‘processed’#重构后光谱<br>
‘PCPE’#重构后PCPE光谱<br>
‘PCPE_norm’#归一化后重构的PCPE光谱<br>
}<br>
## 6.模型训练和预测<br>
**快速开始<br>**
**数据集下载地址:(https://www.scidb.cn/s/NbEFze)<br>
(压缩包内包含一个run文件夹，包含已经训练好的模型，将“CSAM-ResUNet“压缩包解压到该项目根目录，或解压后将“run”文件夹复制到该项目根目录).<br>**
### 6.1光谱重构神经网络：<br>
**─train：光谱重构神经网络模型训练代码<br>**
─parser：配置参数，选择模型，设置batch size，learning rate，epochs等<br>
─train_path：训练数据集路径，加载”dataset_train_20000.mat”路径<br>
─extra_path：额外验证的数据集路径，加载”dataset_extra_10000.mat”路径<br>
─output：训练后模型和结果保存目录为“:/run/模型名称_ _时间戳_”<br>

**─fit：载入训练好的模型，额外验证模型性能<br>**
─extra_path：额外验证的数据集路径，加载”dataset_extra_10000.mat”路径<br>
─run_path：训练好的模型路径（“模型名称_ _时间戳_”)<br>
─output：输出结果保存目录为“:/run/模型名称_ _时间戳_”<br>

**─predict：载入训练好的模型，用于实测的微塑料单一和混合组分拉曼光谱的重构<br>**
─run_path：训练好的模型路径（“模型名称_ _时间戳_”)<br>
─path_list: 选择未重构的混合光谱[path_list_un]，或单组分微塑料光谱[path_list]<br>
─output：输出结果保存目录为“:/run/模型名称_ _时间戳_”<br>

**─predict_refe：载入训练好的模型，用于其他论文公开的拉曼光谱的重构<br>**
─extra_path/dataset_path：数据集路径<br>
─run_path：训练好的模型路径（“模型名称_ _时间戳_”)<br>
─output：结果保存目录为“:/run/模型名称_ _时间戳_”<br>

### 6.2混合微塑料拉曼光谱分类和解混神经网络：<br>
**─train_classify：光谱重构神经网络模型训练代码<br>**
─parser：配置参数，设置batch size，learning rate，epochs等<br>
─path_data_train：训练数据集路径，加载”dataset_train_mix_36000.mat”路径<br>
─path_data_pred：实测混合样品光谱数据集路径<br>
─output：结果保存目录为“:/run/模型名称_ _时间戳_”<br>

**─classify_pred：载入训练好的模型，用于实测的微塑料混合组分拉曼光谱的分类和解混<br>**
─run_path：训练好的模型路径（“模型名称_ _时间戳_”)<br>
─path_list：实测混合样品光谱数据集路径，选择未处理光谱[path_list_un]或处理后光谱[path_list_nn]<br>
─output：结果保存目录为“:/run/模型名称_ _时间戳_”<br>

### 引用
如果本项目在您的研究或工作中有所帮助，请引用我们的论文：<br><br>
@article{CSAM-ResUNet,<br>
  title   = {Cascaded improved neural network for Raman spectra of mixed microplastics reconstruction, classification and unmixing},<br>
  journal = {Analytical Chemistry},<br>
  year    = {2025},<br>
  note    = {Under Review}<br>
}
